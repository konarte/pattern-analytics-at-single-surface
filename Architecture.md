

## 3.1 Общий вид ##
Программный продукт будет построен на модульной архитектуре, самое главное в ней – возможность подключения необходимых фильтров перед анализом изображения плюс выбор необходимого модуля анализа.

В текущем виде мы будем подгружать изображения из файлов. Собственно, источник изображения тоже будет выполнен в модульном виде – в зависимости от типа модуля, данные будут поступать по-разному.


### 3.1.1 Работа с одиночными файлами ###
![http://pattern-analytics-at-single-surface.googlecode.com/svn/wiki/model-report/images/Work_with_single_files.png](http://pattern-analytics-at-single-surface.googlecode.com/svn/wiki/model-report/images/Work_with_single_files.png)

### 3.1.2 Работа с множественными файлами (автоматическая) ###
![http://pattern-analytics-at-single-surface.googlecode.com/svn/wiki/model-report/images/Work_with_multiple_files.png](http://pattern-analytics-at-single-surface.googlecode.com/svn/wiki/model-report/images/Work_with_multiple_files.png)


## 3.2 Поддержка фильтров ##
Фильтр – это класс, реализующий специальный интерфейс. Фильтр может быть написан как на Java, так и на любом языке, который позволит создать динамическую библиотеку (DLL в Windows, Obj в Linux). В задачу фильтров входит: сглаживание изображения, борьба с шумами, увеличение резкости и т.д.

Каждый фильтр должен выполнять отдельное действие и иметь набор параметров, которые могут для него меняться.

Получение и установка параметров будет производиться через разработанные классы, т.е. фильтр отдельным методом возвращает список параметров, которые могут быть установлены, тип этих параметров, ограничения границ, значения по-умолчанию, а при установке эти значения будут переданы фильтр вместе с изображением.

Хранение параметров фильтров в БД будет производиться в JSON-формате.

На текущем этапе мы не будем заморачиваться с установкой специальных классов параметров (например, «область применения фильтра на изображении», т.е. в каком случае данный параметр может быть наложен, а в каком нет).


## 3.3 Модули анализа изображения ##

Модуль анализа занимается тем, что сравнивает существующее изображение с уже сохраненными в базе данных.

Принцип работы прост – мы будем хранить как базовое изображение (с фильтрами и отмасштабированное), так и специально подготовленное для конкретного вида модуля анализа. При попытке сравнить текущий годограф с уже существующими, данный модуль анализа сначала будет пытаться получить нужный ему параметр из таблицы **LocusModuleParams** (для существующего годографа в БД), а если его не найдет – он возьмет его оригинальное изображение и сконвертирует в нужную ему форму для сравнения.

Т.е. для годографов, занесенных в БД одинаковым модулем, сравнение будет производиться быстро, но в том числе это позволит сравнивать графики, занесенные разными модулями анализа.

Например, для модуля матричного анализа мы будем хранить в таблице **LocusModuleParams** параметр с именем **MATRIX**. Содержать он будет матрицу изображения (уже отмасштабированного, с примененными фильтрами) в удобном для вычисления формате. Размер картинки должен составлять 1024x1024 пикселей. Предлагается хранить изображение в виде плоского массива байтов (в поле Blob -- т.н. raw данные). Представление его в виде матрицы не составит труда (разработаны прозрачные способы хранения на уровне интерфейса модуля).

Следует помнить, что изображение может быть проанализировано разными модулями (последовательно), но загружено только одним подходящим.

Следует рассмотреть возможность создания хэша по каждому изображению или каждому случаю (включать в хэш датчик, поверхность, дефект и данные годографа). Можно оставить под это некий граф в БД. Для этого необходимо четко выделить критерии совпадения для компонентов, включаемых в хэш, а также указать условия, при которых эти совпадения выполняются. Быть может, если из годографа можно выделить дополнительную информацию, мы можем ограничиться просто условиями отбора в SQL-запросе?

Ввод параметров изображения может вестись параллельно с просмотром изображения. Во время ввода параметров пользователь выбирает дефект, датчик и поверхность которые будут привязаны к годографу (годограф в отрыве от вышеозначенных вещей быть не может).


## 3.4 Архитектура данных ##


![http://pattern-analytics-at-single-surface.googlecode.com/svn/wiki/model-report/images/Pattern_Analytics_at_Single_Surface_CD.png](http://pattern-analytics-at-single-surface.googlecode.com/svn/wiki/model-report/images/Pattern_Analytics_at_Single_Surface_CD.png)

См. http://code.google.com/p/pattern-analytics-at-single-surface/source/browse/#svn/wiki/model-report